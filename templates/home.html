{% extends 'base.html' %}
{% load static %}
{% load socialaccount %}

{% block page_styles %}
  <link rel="stylesheet" href="{% static 'css/home.css' %}">
  <link rel="manifest" href="{% static 'manifest.json' %}"> 
{% endblock %}


{% block content %}

<div class="home-container">
  
  {% csrf_token %}

  <header class="hero">
    <h1>Selamat datang di Prediksi-Kan</h1>
    <p>Lihat prediksi terbaru, statistik tim, dan dukung pengembangan.</p>
    <p>Data pertandingan akan di perbarui setiap akhir match mingguan tiap liga, biasanya pada hari rabu</p>   
    <div class="hero-actions">
      <a class="btn" href="{% url 'index' %}">Prediksi Sekarang</a>
      <a class="btn sawer" href="https://saweria.co/prediksikan" target="_blank">Dukung Kami</a>
    </div>
  </header>
  
  <section class="suggestion-link">
      <p>Punya ide fitur atau menemukan *bug*? Bantu kami jadi lebih baik!</p>
      <a href="https://saweria.co/prediksikan" target="_blank" class="btn small suggestion-btn">Kirim Saran Pengembangan</a>
  </section>

  {% if user.is_authenticated %}
  <section class="history">
    <h2>Riwayat Prediksi Terbaru</h2> 
    <div id="history-list">(Memuat riwayat...)</div>
    <div class="history-actions">
      <a href="{% url 'history_list' %}" class="btn small view-all-history">Lihat Semua Riwayat</a> 
      <button id="clear-history" class="btn small">Bersihkan Riwayat</button>
    </div>
  </section>
  {% endif %}
  
  {% if not user.is_authenticated %}
  <section class="login-prompt">
      <h2>Simpan Riwayat Prediksi Anda! ğŸ“</h2>
      <p>Ingin melihat kembali prediksi yang pernah Anda buat? Login dengan akun Google Anda untuk menyimpan riwayat secara otomatis.</p>
      <a href="{% url 'account_login' %}" class="btn">Login dengan Google</a>
  </section>
  {% endif %}

  {% if system_stats %}
  <section class="model-win-rate-card">
  <h2>Riwayat Performa Model</h2>
  <p>Ini adalah arsip lengkap dari akurasi model kami setiap kali data pertandingan mingguan diunggah.</p>
  <div class="model-stats-scroller">
    <div class="model-stats-track">
      {% for stat in system_stats %}
        <div class="model-stat-capsule">
          <span class="stat-league">{{ stat.league_name }}</span>
          <div class="stat-data">
            <span class="stat-value">{{ stat.best_bet_win_rate|floatformat:1 }}%</span>
            <span class="stat-detail">{{ stat.best_bet_correct }}/{{ stat.best_bet_total }} Tebakan</span>
          </div>
        </div>
      {% endfor %}
      {% for stat in system_stats %}
        <div class="model-stat-capsule" aria-hidden="true">
          <span class="stat-league">{{ stat.league_name }}</span>
          <div class="stat-data">
            <span class="stat-value">{{ stat.best_bet_win_rate|floatformat:1 }}%</span>
            <span class="stat-detail">{{ stat.best_bet_correct }}/{{ stat.best_bet_total }} Tebakan</span>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  <p class="stat-footer">Dihitung pada: {{ system_stats.0.timestamp|date:"d M Y" }}</p>
  <div class="article-actions" style="margin-top: 20px; margin-bottom: 0;">
    <a href="{% url 'model_performance_page' %}" class="btn small">Lihat Semua Performa</a>
  </div>
</section>
  {% endif %}

  {% if latest_articles %}
  <section class="articles-section">
      <h2>Artikel & Wawasan Terbaru</h2>
      <div class="article-grid">
          {% for article in latest_articles %}
          <a href="{{ article.get_absolute_url }}" class="article-card">
              <div class="article-card-content">
                  <h3>{{ article.title }}</h3>
                  <p>{{ article.excerpt }}</p>
                  <span class="article-card-footer">
                      Oleh {{ article.author.first_name|default:article.author.email }} 
                      - {{ article.created_on|date:"d M Y" }}
                  </span>
              </div>
          </a>
          {% endfor %}
      </div>
      <div class="article-actions">
        <a href="{% url 'article_list' %}" class="btn small">Lihat Semua Artikel</a>
      </div>
  </section>
  {% endif %}

  {% if user.is_authenticated and win_rate_stats %}
    <section class="win-rate-card">
        <h2>ğŸ“Š Win Rate Pilihan Anda</h2>
        {% if win_rate_stats.total_bets > 0 %}
            <p>Anda telah membuat <strong>{{ win_rate_stats.total_bets }}</strong> tebakan pada pertandingan yang telah selesai.</p>
            <div class="win-rate-display">
                <div class="win-rate-value">{{ win_rate_stats.win_rate|floatformat:1 }}<span>%</span></div>
                <div class="win-rate-detail">
                    (<strong>{{ win_rate_stats.total_wins }}</strong> Tebakan Benar)
                </div>
            </div>
        {% else %}
            <p>Statistik Win Rate Anda masih kosong.</p>
            <p>
                Mulai buat prediksi dan pilih tebakan terbaik Anda di halaman <strong>Prediksi</strong>. 
                Hasil dan Win Rate Anda akan muncul di sini setelah data pertandingan terbaru diunggah oleh Admin.
            </p>
        {% endif %}
    </section>
  {% endif %}

  <div class="info-accordion">
    <details class="info-dropdown">
        <summary>Batasan Model (Disclaimer)</summary>
        <div class="info-content">
            <p>
                Sebuah model tidak akan pernah bisa memprediksi bola yang membentur tiang, keputusan VAR yang kontroversial, atau pemain kunci yang tiba-tiba cedera. 
                Sepak bola penuh dengan keacakan. Tembakan yang terdefleksi, kiper yang melakukan penyelamatan mustahil, atau penalti yang gagal. Ini tidak bisa diprediksi.
            </p>
            <p>
                Gunakan prediksi kami sebagai wawasan berbasis data, bukan jaminan hasil akhir.
            </p>
        </div>
    </details>

    <details class="info-dropdown">
        <summary>Tentang Aplikasi Prediksi-Kan</summary>
        <div class="info-content">
            <p>
                <strong>Prediksi-Kan</strong> adalah aplikasi web cerdas yang dirancang untuk memprediksi hasil pertandingan sepak bola secara akurat menggunakan teknologi <strong>Machine Learning</strong> dan <strong>Google Gemini AI</strong>. Â 
                Aplikasi ini memanfaatkan data historis dan analisis statistik mendalam untuk memberikan prediksi yang lebih realistis dan informatif kepada pengguna. Â 
            </p>
            <p>
                Dengan antarmuka yang bersih, interaktif, dan responsif, <strong>Prediksi-Kan</strong> cocok digunakan oleh penggemar sepak bola, analis, hingga pengembang yang tertarik pada penerapan <em>Artificial Intelligence</em> dalam dunia olahraga. Â 
                Kami berkomitmen menghadirkan pengalaman analisis modern yang tidak hanya cepat, tetapi juga intuitif dan dapat diandalkan.
            </p>
        </div>
    </details>

    <details class="info-dropdown">
        <summary>Daftar Liga & Cara Kerja</summary>
        <div class="info-content">
            <h3 class="info-subheading">Daftar Liga</h3>
            <ol>
                <li>Liga Belanda</li>
                <li>Liga Belgia</li>
                <li>Liga Inggris.</li>
                <li>Liga Itali</li>
                <li>Liga Jerman</li>
                <li>Liga Perancis</li>
                <li>Liga Portugal</li>
                <li>Liga Skotlandia</li>
                <li>Liga Spanyol</li>
                <li>Liga Turki</li>
            </ol>
            <p>Kamu juga bisa memilih <strong>All League</strong> sebagai alat untuk prediksi <strong>UCL</strong></p>

            <h3 class="info-subheading">Cara Kerja Prediksi</h3>
            <ol>
                <li>Pilih liga dan tim yang ingin kamu analisis di halaman <strong>Prediksi</strong>.</li>
                <li>Data dimasukkan ke dalam model pembelajaran mesin yang telah dilatih.</li>
                <li>Hasil prediksi ditampilkan langsung dan disimpan ke dalam riwayat (jika Anda login).</li>
            </ol>
            <p>Kamu juga bisa memantau performa prediksi di halaman <strong>Statistik</strong>.</p>
        </div>
    </details>
</div>
</div>

<footer class="main-footer">
    <div class="footer-copyright">&copy; 2025 Prediksi-Kan. All rights reserved.</div>
    <div class="footer-data-source">Data sourced from <a href="https://www.football-data.co.uk/" target="_blank" rel="noopener noreferrer">football-data.co.uk</a></div>
</footer>

<script src="{% static 'js/home.js' %}"></script>
{% endblock %}